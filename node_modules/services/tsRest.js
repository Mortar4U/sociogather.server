var TS = require("services/ts");


function tsRest(app) {
  var ts = new TS();

  app.post("/ts/connect", function(req, res) {
    ts.connect(req.data)
      .done(function(connection) {
        res.send({id: connection.id});
      });
  });

  app.get("/ts/messages", function(req, res) {
    ts.getAllMessages()
      .done(function(messages) {
        res.send(messages);
      });
  });


  app.delete("/ts/messages", function(req, res) {
    res.send(200, "I told you not to call this interface!");
  });


  app.get("/ts/message/:id", function(req, res) {
    ts.getMessage(req.params.id)
      .done(function(message) {
        res.send(message);
      })
      .fail(function() {
        res.send(404, "Not found");
      });
  });


  app.post("/ts/message", function(req, res) {
    ts.createMessage(req.body)
      .done(function(message) {
        res.send(message);
      });
  });


  app.put("/ts/message", function(req, res) {
    ts.updateMessage(req.body)
      .done(function(message) {
        res.send(message);
      })
      .fail(function() {
        res.send(404, "Not found");
      });
  });


  app.delete("/ts/message:id", function(req, res) {
    ts.deleteMessage(req.params.id)
      .done(function(message) {
        res.send(message);
      })
      .fail(function() {
        res.send(404, "Not found");
      });
  });
}


module.exports = tsRest;
